<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Cloud Native Infrastructure: Part 1 Service Discovery - Luthadel</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Cloud Native Infrastructure: Part 1 Service Discovery"><meta property="og:description" content="Service discovery components maintain a list of service instances that are available for work within a microservice domain."><meta property="og:type" content="article"><meta property="og:url" content="https://rudeigerc.github.io/posts/cloud_native_infrastructure_service_discovery/"><meta property="article:published_time" content="2019-05-27T22:23:43+08:00"><meta property="article:modified_time" content="2019-12-28T20:18:33+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cloud Native Infrastructure: Part 1 Service Discovery"><meta name=twitter:description content="Service discovery components maintain a list of service instances that are available for work within a microservice domain."><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://rudeigerc.github.iocss/normalize.css><link rel=stylesheet type=text/css media=screen href=https://rudeigerc.github.iocss/main.css><link rel=stylesheet type=text/css href=https://rudeigerc.github.io/css/custom.css><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script src=https://rudeigerc.github.iojs/main.js></script></head><body><div class="container wrapper post"><div class=header><h1 class=site-title><a href=https://rudeigerc.github.io>Luthadel</a></h1><div class=site-description><h2>Yuchen Cheng's Blog</h2><nav class="nav social"><ul class=flat><a href=https://github.com/rudeigerc title=GitHub><i data-feather=github></i></a><a href=https://www.facebook.com/rudeigercheng title=Facebook><i data-feather=facebook></i></a><a href=https://www.linkedin.com/in/rudeigerc/ title=LinkedIn><i data-feather=linkedin></i></a><a href=mailto:rudeigerc@gmail.com title=Email><i data-feather=mail></i></a><a href=/index.xml title=RSS><i data-feather=rss></i></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div><div class=post-header><h1 class=title>Cloud Native Infrastructure: Part 1 Service Discovery</h1><div class=meta>Posted at &mdash; May 27, 2019</div></div><div class=markdown><h2 id=introduction>Introduction</h2><p><strong>Service discovery</strong> components maintain a list of service instances that are available for work within a microservice domain, which is the most important part in microservice architecture. The advantage of service discovery components is that clients do not need to know the exact position of services, what they have are just the registered name of services if they want to call or use them.</p><p>Usually, a microservice will register itself to the center of service discovery components when it was started successfully, including necessary parameters such as the unique name of service, IP address and the port bind. This process is called as <strong>Service Registry</strong>.</p><p>The mainstream solutions of service discovery include <strong>mDNS</strong>（multicast Domain Name Service）, <strong>ZooKeeper</strong> and <strong>etcd</strong>, which are based on distributed key-value storage service, <strong>Eureka</strong>, open-sourced by Netflix, and <a href=https://www.consul.io/><strong>Consul</strong></a>, open-sourced by HashiCorp etc.</p><h2 id=consul>Consul</h2><p>Consul is a service mesh solution providing a full featured control plane with service discovery, configuration, and segmentation functionality.</p><h3 id=installation>Installation</h3><h4 id=development-environment>Development Environment</h4><p><strong>NOTICE: You should not just use <code>consul agent -dev</code> in production environment.</strong></p><p>In <code>docker-compose.yml</code>:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>version:<span style=color:#bbb> </span><span style=color:#d14>&#34;3&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb></span>services:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>consul:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>image:<span style=color:#bbb> </span>consul<span style=color:#bbb>
</span><span style=color:#bbb>    </span>container_name:<span style=color:#bbb> </span>consul<span style=color:#bbb>
</span><span style=color:#bbb>    </span>ports:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>-<span style=color:#bbb> </span><span style=color:#d14>&#34;8300:8300&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>-<span style=color:#bbb> </span><span style=color:#d14>&#34;8400:8400&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>-<span style=color:#bbb> </span><span style=color:#d14>&#34;8500:8500&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>-<span style=color:#bbb> </span><span style=color:#d14>&#34;8600:53/udp&#34;</span><span style=color:#bbb>
</span></code></pre></div><p>Just run <code>docker-compose up -d</code> and then the container named <code>consul</code> will be created.</p><p>Consul provides HTTP API for users to check the status of nodes in the cluster, and a UI at <code>:8500</code> by default.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl localhost:8500/v1/catalog/nodes
<span style=color:#000;font-weight:700>[</span>
    <span style=color:#000;font-weight:700>{</span>
        <span style=color:#d14>&#34;ID&#34;</span>: <span style=color:#d14>&#34;fbd0daa0-84e4-41d4-69d2-9c446c79c5c2&#34;</span>,
        <span style=color:#d14>&#34;Node&#34;</span>: <span style=color:#d14>&#34;c7bc60a1e9b0&#34;</span>,
        <span style=color:#d14>&#34;Address&#34;</span>: <span style=color:#d14>&#34;127.0.0.1&#34;</span>,
        <span style=color:#d14>&#34;Datacenter&#34;</span>: <span style=color:#d14>&#34;dc1&#34;</span>,
        <span style=color:#d14>&#34;TaggedAddresses&#34;</span>: <span style=color:#000;font-weight:700>{</span>
            <span style=color:#d14>&#34;lan&#34;</span>: <span style=color:#d14>&#34;127.0.0.1&#34;</span>,
            <span style=color:#d14>&#34;wan&#34;</span>: <span style=color:#d14>&#34;127.0.0.1&#34;</span>
        <span style=color:#000;font-weight:700>}</span>,
        <span style=color:#d14>&#34;Meta&#34;</span>: <span style=color:#000;font-weight:700>{</span>
            <span style=color:#d14>&#34;consul-network-segment&#34;</span>: <span style=color:#d14>&#34;&#34;</span>
        <span style=color:#000;font-weight:700>}</span>,
        <span style=color:#d14>&#34;CreateIndex&#34;</span>: 9,
        <span style=color:#d14>&#34;ModifyIndex&#34;</span>: <span style=color:#099>10</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>]</span>
</code></pre></div><h2 id=summary>Summary</h2><p>Service discovery is the basic of microservices, which provides the registry center in the distributed application system.</p></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/cloud-native>cloud-native</a></li><li><a href=/tags/microservices>microservices</a></li><li><a href=/tags/service-discovery>service-discovery</a></li></ul></nav></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='rudeigerc';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div class="footer wrapper"><nav class=nav><div>© 2020 Yuchen Cheng. This site is licensed under CC-BY-SA-4.0. | <a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-110870583-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script>feather.replace()</script></body></html>