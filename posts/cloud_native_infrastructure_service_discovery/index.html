<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Cloud Native Infrastructure: Part 1 Service Discovery"><meta property="og:description" content="Service discovery components maintain a list of service instances that are available for work within a microservice domain."><meta property="og:type" content="article"><meta property="og:url" content="https://rudeigerc.dev/posts/cloud_native_infrastructure_service_discovery/"><meta property="article:published_time" content="2019-05-27T22:23:43+08:00"><meta property="article:modified_time" content="2020-08-03T01:59:51+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cloud Native Infrastructure: Part 1 Service Discovery"><meta name=twitter:description content="Service discovery components maintain a list of service instances that are available for work within a microservice domain."><base href=https://rudeigerc.dev/><title>Cloud Native Infrastructure: Part 1 Service Discovery | Luthadel</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body);></script><link rel=stylesheet href=https://rudeigerc.dev/sass/main.min.06caa1252a1f6a17d6299cdcfedb5134ab94df4dfdb142c8a2ce0bf111cbec12.css><script src=https://kit.fontawesome.com/ab13fc9725.js crossorigin=anonymous></script></head><body><div><h1 class=title>Luthadel</h1><h2 class=subtitle>Yuchen Cheng's Blog</h2><div class=social><div class=social-icon><a href=https://github.com/rudeigerc title=GitHub><i class="fab fa-github"></i></a></div><div class=social-icon><a href=https://twitter.com/yuchen_cheng title=Twitter><i class="fab fa-twitter"></i></a></div><div class=social-icon><a href=https://www.linkedin.com/in/rudeigerc/ title=LinkedIn><i class="fab fa-linkedin"></i></a></div><div class=social-icon><a href=mailto:rudeigerc@gmail.com title=E-mail><i class="fas fa-envelope"></i></a></div><div class=social-icon><a href=# title=Resume><i class="fas fa-file"></i></a></div><div class=social-icon><a href=/index.xml title=RSS><i class="fas fa-rss"></i></a></div></div><div class=menu><div class=menu-item><a href=/>Home</a></div><div class=menu-item><a href=/categories>Catagories</a></div><div class=menu-item><a href=/tags>Tags</a></div><div class=menu-item><a href=/about>About</a></div></div></div><div id=content><section id=main><h1 id=title>Cloud Native Infrastructure: Part 1 Service Discovery</h1><div class="single date">2019-05-27</div><div class=tags><div class=tag><a href=tags/cloud-native>#cloud-native</a></div><div class=tag><a href=tags/microservices>#microservices</a></div><div class=tag><a href=tags/service-discovery>#service-discovery</a></div></div><div><article id=content><h2 id=introduction>Introduction</h2><p><strong>Service discovery</strong> components maintain a list of service instances that are available for work within a microservice domain, which is the most important part in microservice architecture. The advantage of service discovery components is that clients do not need to know the exact position of services, what they have are just the registered name of services if they want to call or use them.</p><p>Usually, a microservice will register itself to the center of service discovery components when it was started successfully, including necessary parameters such as the unique name of service, IP address and the port bind. This process is called as <strong>Service Registry</strong>.</p><p>The mainstream solutions of service discovery include <strong>mDNS</strong>（multicast Domain Name Service）, <strong>ZooKeeper</strong> and <strong>etcd</strong>, which are based on distributed key-value storage service, <strong>Eureka</strong>, open-sourced by Netflix, and <a href=https://www.consul.io/><strong>Consul</strong></a>, open-sourced by HashiCorp etc.</p><h2 id=consul>Consul</h2><p>Consul is a service mesh solution providing a full featured control plane with service discovery, configuration, and segmentation functionality.</p><h3 id=installation>Installation</h3><h4 id=development-environment>Development Environment</h4><p><strong>NOTICE: You should not just use <code>consul agent -dev</code> in production environment.</strong></p><p>In <code>docker-compose.yml</code>:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000;font-weight:700>version</span>:<span style=color:#bbb> </span><span style=color:#d14>&#34;3&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#000;font-weight:700>services</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#000;font-weight:700>consul</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>image</span>:<span style=color:#bbb> </span>consul<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>container_name</span>:<span style=color:#bbb> </span>consul<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>ports</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#d14>&#34;8300:8300&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#d14>&#34;8400:8400&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#d14>&#34;8500:8500&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#d14>&#34;8600:53/udp&#34;</span><span style=color:#bbb>
</span></code></pre></td></tr></table></div></div><p>Just run <code>docker-compose up -d</code> and then the container named <code>consul</code> will be created.</p><p>Consul provides HTTP API for users to check the status of nodes in the cluster, and a UI at <code>:8500</code> by default.</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl localhost:8500/v1/catalog/nodes
<span style=color:#000;font-weight:700>[</span>
    <span style=color:#000;font-weight:700>{</span>
        <span style=color:#d14>&#34;ID&#34;</span>: <span style=color:#d14>&#34;fbd0daa0-84e4-41d4-69d2-9c446c79c5c2&#34;</span>,
        <span style=color:#d14>&#34;Node&#34;</span>: <span style=color:#d14>&#34;c7bc60a1e9b0&#34;</span>,
        <span style=color:#d14>&#34;Address&#34;</span>: <span style=color:#d14>&#34;127.0.0.1&#34;</span>,
        <span style=color:#d14>&#34;Datacenter&#34;</span>: <span style=color:#d14>&#34;dc1&#34;</span>,
        <span style=color:#d14>&#34;TaggedAddresses&#34;</span>: <span style=color:#000;font-weight:700>{</span>
            <span style=color:#d14>&#34;lan&#34;</span>: <span style=color:#d14>&#34;127.0.0.1&#34;</span>,
            <span style=color:#d14>&#34;wan&#34;</span>: <span style=color:#d14>&#34;127.0.0.1&#34;</span>
        <span style=color:#000;font-weight:700>}</span>,
        <span style=color:#d14>&#34;Meta&#34;</span>: <span style=color:#000;font-weight:700>{</span>
            <span style=color:#d14>&#34;consul-network-segment&#34;</span>: <span style=color:#d14>&#34;&#34;</span>
        <span style=color:#000;font-weight:700>}</span>,
        <span style=color:#d14>&#34;CreateIndex&#34;</span>: 9,
        <span style=color:#d14>&#34;ModifyIndex&#34;</span>: <span style=color:#099>10</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>]</span>
</code></pre></td></tr></table></div></div><h2 id=summary>Summary</h2><p>Service discovery is the basic of microservices, which provides the registry center in the distributed application system.</p></article></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='rudeigerc';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><footer><div><p class=footer>© 2020 Yuchen Cheng. This site is licensed under a Creative Commons Attribution 4.0 International license.<br>Theme <a href=https://github.com/rudeigerc/yggdrasill>Yggdrasill</a> | Powered by <a href=https://gohugo.io>Hugo</a></p></div></footer><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-110870583-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>